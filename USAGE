Pipeline for MRDS
=========================

USAGE

nextflow run main.nf --input ... [OPTIONAL_ARGUMENTS]
To call with a container add:
    -with-singularity mrds_flow.sif
    -with-docker mrds_flow

You will need this container (tag:1.0.0) in order to run the pipeline.
- https://hub.docker.com/r/erickberto/mrds-flow

MRDS must be installed from https://github.com/rcleija/mrds (already install in the container)


Warning
=======
If using this pipeline, please read and cite the following publications:
[1] MRDS-paper 
[2] Frontiers paper

DESCRIPTION

    --input=/path/to/[root]             Root folder containing multiple subjects

                                        [root]
                                        ├── S1
                                        │   ├── *dwi.nii.gz
                                        │   ├── *mask.nii.gz (wm mask is highly recommended)
                                        │   ├── *scheme.b (optinal if fsl scheme files are provided)
                                        |   ├── *scheme.bvec (optinal if mrtrix scheme file is provided)
                                        |   ├── *scheme.bval (optinal if mrtrix scheme file is provided)
                                        │   └── *tracking.trk (optional to perform TODI model selection)
                                        └── S2
                                            └── *

    OPTIONAL ARGUMENTS (current value)
    --use_isotropic                     Include isotropic tensor fitting to MRDS ($use_isotropic)
    --model_selection                   Preliminar model selector for MRDS ($model_selection)
    --mrds_processes                    The number of parallel processes used for FIT_MRDS ($mrds_processes)
    --processes                         The number of parallel processes to launch ($cpu_count).
                                        Only affects the local scheduler.


AVAILABLE PROFILES (using -profile option (e.g. -profile fully_reproducible, cbrain))

fully_reproducible                       When this profile is used, all the parameters will be set to have 100% reproducible results.

macos                                    When this profile is used, mrds_flow will modify a parameter (scratch) for MacOS users.

cbrain                                   When this profile is used, Nextflow will copy all the output files in publishDir and not use symlinks.

OUTPUT

The output files have the following format:

`results_MRDS_<method>_<modsel>_<metric>.nii.gz`,

where

<method> represents the method used by MRDS to fit the multi-tensors at each voxel.
There are 3 different methods:
    'Fixed': All tensors eigenvalues are fixed.
    'Equal': All tensors eigenvalues are estimated assuming all tensors are equal.
    'Diff':  All tensors eigenvalues are estimated differently.

<modsel> represents the model selection used by MRDS to estimate the number of
tensors per voxel. There are 5 different models:
    'V1': All voxels have exactly 1 tensors.
    'V2': All voxels have exactly 2 tensors.
    'V3': All voxels have exactly 3 tensors.
    'BIC': Bayesian Information Criteria (BIC) determinates the number of tensors
    'TODI': Track Orientation Distribution Imagining (TODI) determinates the number of tensors.

<metric> represents the actual metric stored in the file. There 
    'FA': fixel-FA metric
    'RD': fixel-RD metric
    'AD': fixel-AD metric
    'MD': fixel-MD metric
    'PDDs_CARTESIAN': Principal diffusion directions of the tensors
    'NUM_COMP': Number of tensors
    'COMP_SIZE': Compartment sizes of the tensors
    'ISOTROPIC': Isotropic volumen fraction and diffusivity
    'EIGENVALUES': Eigenvalues of the tensors.

NOTES

The 'scilpy/scripts' and MRDS bin folders should be in your PATH environment variable. Not necessary if the
Singularity container is used.

The intermediate working directory is, by default, set to './work'.
To change it, use the '-w WORK_DIR' argument.

The default config file is mrds_flow/nextflow.config.
Use '-C config_file.config' to specify a non-default configuration file.
The '-C config_file.config' must be inserted after the nextflow call
like 'nextflow -C config_file.config run ...'.